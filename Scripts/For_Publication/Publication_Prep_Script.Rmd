---
title: "Publication_Prep_Script"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      warning = FALSE, 
                      message = FALSE)
```


# Publication Prep Notes: 
-  Going to focus solely on the settlement processes (experiment and in situ tiles), and pull out the post-settlement survivorship data for this story 
-  This may open up some room to redo/re-introduce the structural equation model and look at indirect effects of SGD
-  The potential relationships being tested are: SGD --> Settlement, Adult Pocillopora Cover --> Settlement, SGD --> Adult Pocillopora Cover


### Load libraries 
```{r}
library(tidyverse)
library(here)
library(ggrepel)
library(patchwork)
library(tidytext)
library(AICcmodavg)
library(kableExtra)
library(PNWColors)
library(factoextra)
library(devtools)
library(ggbiplot)
library(car)
```


### Load Data
```{r}
###########
### Poc cover data 
###########
EnvData_wrecruitcounts <- read_csv(here::here("Data", "CommComp_recruit_seasonavg_envdata.csv"))

Poc_cover_data <- read_csv(here::here("Data", "Species_Composition_2022_Danielle.csv"))

#PercentCover <- read_csv("https://raw.githubusercontent.com/dbarnas/Community_Functional_Diversity/main/Data/Full_Metadata.csv")

PercentCover3 <- read_csv(here::here("Data", "PercentCover3.csv"))

RecruitmentCounts2.1 <- read_csv((here::here("Data", "RecruitmentCounts2.1.csv")))

## use this to try and get ambient SW TA and nutrients 
CarbonateChem <- read_csv("https://raw.githubusercontent.com/njsilbiger/MooreaSGD_site-selection/main/Data/March2022/CarbonateChemistry/pHProbe_Data_calculated_POcorrect.csv")


### EnvData_wPocCover was originally cleaned and saved in Poc_Cover_Data script 

EnvData_wPocCover <- read_csv((here::here("Data", "EnvData_wPocCover.csv")))

```


### July 18th, 2025: Re-testing Pocillopora Cover with SGD relationship 
```{r}
## plot scatterplot to see general relationship between SGD and coral cover 
SGD_Cover_Relationship <- EnvData_wPocCover %>% 
  ggplot(aes(x=silicate_avg, 
             y=log(percent_cover+1), 
             color=Location)) + 
  geom_point(size=3) + 
  theme_bw()

SGD_Cover_Relationship

## model the relationship to test significance 
## only for Varari 

model2 <- lm(log(percent_cover+1) ~ (silicate_avg) + I(silicate_avg^2), data = EnvData_wPocCover %>% 
               filter(Location == "Varari"))

anova(model2)

## add site interaction to see how it affects power 
model3 <- lm(log(percent_cover+1) ~ (silicate_avg) + I(silicate_avg^2)*Location, data = EnvData_wPocCover)

anova(model3)
```

## re-testing average settlement counts per site

```{r}
## create new dfs to look at means across both sites more easily 
C_tiles <- RecruitmentCounts2.1 %>% 
  filter(Location=="Cabral")

V_tiles <- RecruitmentCounts2.1 %>% 
  filter(Location=="Varari")


# range of settlement counts 
min(C_tiles$sum_total) #0
max(C_tiles$sum_total) #146 

min(V_tiles$sum_total) #2
max(V_tiles$sum_total) #131

# mean and se of settlement counts per site 

## Cabral 
mean(C_tiles$sum_total) #21.65
sd_C <- sd(C_tiles$sum_total, na.rm=TRUE)
se_C <- sd_C/sqrt(20) ##7.87

## Varari 
mean(V_tiles$sum_total) ##33.8
sd_V <- sd(V_tiles$sum_total, na.rm=TRUE)
se_V <- sd_V/sqrt(20) ##8.21

# mean settlement counts per tile 

```


#### Sept 13th, 2025: Getting average N and TA values for reef crests 

```{r}

MooreaMarch_full <- read_csv("https://raw.githubusercontent.com/njsilbiger/MooreaSGD_site-selection/main/Data/March2022/Allbiogeochemdata_QC_march_fdom2.csv")
MooreaAugust2 <- read_csv("https://raw.githubusercontent.com/njsilbiger/MooreaSGD_site-selection/main/Data/August2021/Allbiogeochemdata_QC2.csv")


MooreaAugust2_edit <- MooreaAugust2 %>% 
  select(-c(,2:7,10:14,16,24:30))
MooreaMarch_edit <- MooreaMarch_full %>% 
  select(-c(,2:7,10:14,16,24:30))

MooreaAugust_addedOffshore <- MooreaMarch_edit %>%  
  full_join(MooreaAugust2_edit)



nut_dfedit <- MooreaAugust_addedOffshore %>% 
  dplyr::filter(Plate_Seep == "Offshore") %>% 
  dplyr::select(c(1,3,5,6,10)) %>% 
  dplyr::filter(Date != "3/26/2022"&Date != "3/27/2022"&Date != "3/28/2022")

#####
V_nuts <- nut_dfedit %>% 
  dplyr::filter(Location=="Varari") %>% 
  dplyr::summarize(avgTA=mean(TA), 
                   sdTA = sd(TA),
                   seTA = sdTA / sqrt(length(TA)),
                   avgN=mean(NN_umolL, na.rm=TRUE),
                   sdN = sd(NN_umolL, na.rm=TRUE), 
                   seN = sdN/sqrt(length(NN_umolL)))

C_nuts <- nut_dfedit %>% 
  dplyr::filter(Location=="Cabral") %>% 
  dplyr::summarize(avgTA=mean(TA), 
                   sdTA = sd(TA),
                   seTA = sdTA / sqrt(length(TA)),
                   avgN=mean(NN_umolL, na.rm=TRUE),
                   sdN = sd(NN_umolL, na.rm=TRUE), 
                   seN = sdN/sqrt(length(NN_umolL)))
```











